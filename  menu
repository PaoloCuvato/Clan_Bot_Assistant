package PlayerInfo;

import Stat.PlayerStats;
import Stat.PlayerStatsManager;
import net.dv8tion.jda.api.EmbedBuilder;
import net.dv8tion.jda.api.entities.User;
import net.dv8tion.jda.api.entities.emoji.Emoji;
import net.dv8tion.jda.api.events.interaction.command.SlashCommandInteractionEvent;
import net.dv8tion.jda.api.events.message.react.MessageReactionAddEvent;
import net.dv8tion.jda.api.hooks.ListenerAdapter;
import net.dv8tion.jda.api.interactions.commands.OptionMapping;
import net.dv8tion.jda.api.utils.FileUpload;

import java.awt.*;
import java.io.File;
import java.time.Instant;
import java.util.Map;
import java.util.concurrent.ConcurrentHashMap;

public class SlashPlayerInfoManager extends ListenerAdapter {

    private final Map<Long, Long> messageIdToUserId = new ConcurrentHashMap<>();
    private final PlayerStatsManager statsManager = PlayerStatsManager.getInstance();

    private static SlashPlayerInfoManager instance;

    public static synchronized SlashPlayerInfoManager getInstance() {
        if (instance == null) {
            instance = new SlashPlayerInfoManager();
        }
        return instance;
    }

    @Override
    public void onSlashCommandInteraction(SlashCommandInteractionEvent event) {
        String command = event.getName();

        if (command.equals("my_ninjacard")) {
            long userId = event.getUser().getIdLong();
            PlayerInfo p = PlayerInfoStorage.getPlayerInfo(userId);
            PlayerStats stats = statsManager.getPlayerStats(userId);

            if (p == null || stats == null) {
                event.reply("‚ùå Player info or stats not found for you!").setEphemeral(true).queue();
                return;
            }

            EmbedBuilder ninjaCardEmbed = getNinjaCardEmbed(p);

            event.deferReply().queue();

            event.getHook().sendMessageEmbeds(ninjaCardEmbed.build()).queue(sentMessage -> {
                messageIdToUserId.put(sentMessage.getIdLong(), userId);
                sentMessage.addReaction(Emoji.fromUnicode("üë§")).queue();
                sentMessage.addReaction(Emoji.fromUnicode("üåç")).queue();
                sentMessage.addReaction(Emoji.fromUnicode("üïπÔ∏è")).queue();
            });

        } else if (command.equals("search_ninjacard")) {

            OptionMapping targetOption = event.getOption("target");
            if (targetOption == null) {
                event.reply("‚ùå You must specify a user to search.").setEphemeral(true).queue();
                return;
            }

            User targetUser = targetOption.getAsUser();
            long targetUserId = targetUser.getIdLong();

            PlayerInfo p = PlayerInfoStorage.getPlayerInfo(targetUserId);
            PlayerStats stats = statsManager.getPlayerStats(targetUserId);

            if (p == null || stats == null) {
                event.reply("‚ùå This user has not created their Ninja Card yet.").setEphemeral(true).queue();
                return;
            }

            EmbedBuilder ninjaCardEmbed = getNinjaCardEmbed(p);

            event.deferReply().queue();
            event.getHook().sendMessageEmbeds(ninjaCardEmbed.build()).queue(sentMessage -> {
                messageIdToUserId.put(sentMessage.getIdLong(), targetUserId);
                sentMessage.addReaction(Emoji.fromUnicode("üë§")).queue();
                sentMessage.addReaction(Emoji.fromUnicode("üåç")).queue();
                sentMessage.addReaction(Emoji.fromUnicode("üïπÔ∏è")).queue();
            });

        } else if (command.equals("send_player_info_file")) {
            event.deferReply().queue();

            File file = new File("playerinfolist.txt");

            if (!file.exists()) {
                event.getHook().sendMessage("‚ùå The file playerinfolist.txt was not found.").queue();
                return;
            }

            event.getHook().sendMessage("üìÑ Here is a text file containing all the users with the Player Info role:")
                    .addFiles(FileUpload.fromData(file))
                    .queue();
        }
    }

    @Override
    public void onMessageReactionAdd(MessageReactionAddEvent event) {
        if (event.getUser().isBot()) return;

        long messageId = event.getMessageIdLong();
        long userId = Long.parseLong(event.getUserId());

        if (!messageIdToUserId.containsKey(messageId)) return;

        long targetId = messageIdToUserId.get(messageId);

        PlayerInfo p = PlayerInfoStorage.getPlayerInfo(targetId);
        PlayerStats stats = statsManager.getPlayerStats(targetId);
        if (p == null || stats == null) return;

        String emoji = event.getReaction().getEmoji().getName();

        EmbedBuilder newEmbed;
        switch (emoji) {
            case "üë§":
                newEmbed = getNinjaCardEmbed(p);
                break;
            case "üåç":
                newEmbed = getGeneralStatsEmbed(stats);
                break;
            case "üïπÔ∏è":
                newEmbed = getDirectStatsEmbed(stats);
                break;
            default:
                return;
        }

        EmbedBuilder finalEmbed = newEmbed;
        event.retrieveMessage().queue(message -> {
            message.editMessageEmbeds(finalEmbed.build()).queue();
            event.getReaction().removeReaction(event.getUser()).queue();
        });
    }

    private EmbedBuilder getNinjaCardEmbed(PlayerInfo p) {
        return new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ Your Ninja Card ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.decode("#1c0b2e"))
                .setDescription(
                        "**# Ninja Card Info:**" +
                                "These are all the stat about your player ninja card\n" +
                                " * **Platform:** " + String.join(", ", p.getPlatforms()) + "\n" +
                                " * **Game:** " + String.join(", ", p.getGame()) + "\n" +
                                " * **Player Name:** " + p.getPlayerName() + "\n" +
                                " * **Connection:** " + p.getConnectionType() + "\n" +
                                " * **My Region:** " + p.getCurrentRegion() + "\n" +
                                " * **Target Region:** " + p.getTargetRegion() + "\n" +
                                " * **Languages:** " + String.join(", ", p.getSpokenLanguages()) + "\n" +
                                " * **Availability:** " + p.getAvailablePlayTime() + "\n" +
                                " * **Hours Played:** " + p.getInGamePlayTime() + "\n" +
                                " * **Lobbies Joined:** " + p.getLobbyCounter() + "\n" +
                                "‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨"
                );
    }

    private EmbedBuilder getGeneralStatsEmbed(PlayerStats stats) {
        return new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ Your General Stats ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.decode("#1c0b2e"))
                .setDescription(
                        "**# General Stats:**" +
                                "These are all the stat about your public lobby history\n" +
                                " * **Lobbies Created: **" + stats.getLobbiesCreatedGeneral() + "\n" +
                                " * **Lobbies Joined: **" + stats.getLobbiesJoinedGeneral() + "\n" +
                                " * **Host Accepted Users: **" + stats.getHostAcceptedUserGeneral() + "\n" +
                                " * **Was Accepted: **" + stats.getWasAcceptedGeneral() + "\n" +
                                " * **Declined Users: **" + stats.getDeclinedUserGeneral() + "\n" +
                                " * **Was Declined: **" + stats.getWasDeclinedGeneral() + "\n" +
                                " * **Ignored Requests: **" + stats.getIgnoredRequestGeneral() + "\n" +
                                " * **Lobbies Completed: **" + stats.getLobbiesCompletedGeneral() + "\n" +
                                " * **Lobbies Incomplete: **" + stats.getLobbiesIncompleteGeneral() + "\n" +
                                " * **Lobbies Disbanded: **" + stats.getLobbiesDisbandedGeneral() + "\n" +
                             //   " * **Score: **" + stats.getScore() + "\n" +
                                "‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨"
                );
    }

    private EmbedBuilder getDirectStatsEmbed(PlayerStats stats) {
        return new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ Your Direct Stats ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.decode("#1c0b2e"))
                .setDescription(
                        "**# Direct Stats:**" +
                                "These are all the stat about your private lobby history\n" +
                                " * **Lobbies Created: **" + stats.getLobbiesCreatedDirect() + "\n" +
                                " * **Lobbies Joined: **" + stats.getLobbiesJoinedDirect() + "\n" +
                                " * **Was Accepted: **" + stats.getWasAcceptedDirect() + "\n" +
                                " * **Declined Users: **" + stats.getDeclinedUserDirect() + "\n" +
                                " * **Was Declined: **" + stats.getWasDeclinedDirect() + "\n" +
                                " * **Ignored Requests: **" + stats.getIgnoredRequestDirect() + "\n" +
                                " * **Lobbies Completed: **" + stats.getLobbiesCompletedDirect() + "\n" +
                                " * **Lobbies Incomplete: **" + stats.getLobbiesIncompleteDirect() + "\n" +
                                " * **Lobbies Disbanded: **" + stats.getLobbiesDisbandedDirect() + "\n" +
                                "‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨"
                );
    }
}



















































package PlayerInfo;

import Stat.PlayerStats;
import Stat.PlayerStatsManager;
import net.dv8tion.jda.api.EmbedBuilder;
import net.dv8tion.jda.api.entities.User;
import net.dv8tion.jda.api.events.guild.GuildReadyEvent;
import net.dv8tion.jda.api.events.interaction.command.SlashCommandInteractionEvent;
import net.dv8tion.jda.api.events.interaction.component.StringSelectInteractionEvent;
import net.dv8tion.jda.api.events.interaction.ModalInteractionEvent;
import net.dv8tion.jda.api.hooks.ListenerAdapter;
import net.dv8tion.jda.api.interactions.components.selections.StringSelectMenu;
import net.dv8tion.jda.api.interactions.components.text.TextInput;
import net.dv8tion.jda.api.interactions.components.text.TextInputStyle;
import net.dv8tion.jda.api.interactions.modals.Modal;

import java.awt.*;
import java.util.Map;
import java.util.Objects;

public class AddInfoCardCommand extends ListenerAdapter {

    private long lastQueriedUserId = -1;

    @Override
    public void onSlashCommandInteraction(SlashCommandInteractionEvent event) {
        switch (event.getName()) {
            case "add_info_card" -> handleAddInfoCard(event);
            case "edit_ninja_card" -> handleEditInfoCard(event);
            case "my_ninjacard" -> handleNinjaCard(event);
         //   case "search_ninjacard" -> handleSearchNinjaCard(event);
        }
    }

    private void handleAddInfoCard(SlashCommandInteractionEvent event) {
        User user = event.getUser();
        long discordId = user.getIdLong();

        PlayerInfo player = new PlayerInfo();
        player.setDiscordId(discordId);
        player.setDiscordUsername(user.getName());
        player.setLobbyCounter(0);

        PlayerInfoStorage.addOrUpdatePlayerInfo(discordId, player);

        sendIntroEmbed(event, "Create Your Ninja Info Card", "This command helps you set up your player profile to join lobbies and participate in events.");
    }

    private void handleEditInfoCard(SlashCommandInteractionEvent event) {
        User user = event.getUser();
        long discordId = user.getIdLong();

        PlayerInfo player = PlayerInfoStorage.getPlayerInfo(discordId);
        if (player == null) {
            event.reply("‚ùå No profile found. Use `/add_info_card` to create one.").setEphemeral(true).queue();
            return;
        }

        sendIntroEmbed(event, "Edit Your Ninja Info Card", "This command lets you update your existing player profile.");
    }

    private void handleNinjaCard(SlashCommandInteractionEvent event) {
        long discordId = event.getUser().getIdLong();
        PlayerInfo player = PlayerInfoStorage.getPlayerInfo(discordId);
        PlayerStats stats = PlayerStatsManager.getInstance().getPlayerStats(discordId);

        if (player == null || stats == null) {
            event.reply("‚ùå No profile or stats found.").setEphemeral(true).queue();
            return;
        }

        lastQueriedUserId = discordId;

        EmbedBuilder embed = new EmbedBuilder()
                .setTitle("üé¥ Ninja Card Menu")
                .setDescription("Select an option below to view your information.")
                .setColor(Color.white);

        event.replyEmbeds(embed.build())
                .addActionRow(
                        StringSelectMenu.create("ninjacard:menu")
                                .setPlaceholder("Choose an option")
                                .addOption("Ninja Card", "ninjacard")
                                .addOption("General Stats", "general")
                                .addOption("Direct Stats", "direct")
                                .build()
                )
                .setEphemeral(true)
                .queue();
    }

    private void sendIntroEmbed(SlashCommandInteractionEvent event, String title, String description) {
        EmbedBuilder intro = new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ " + title + " ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setDescription(" > " + description + "\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.white);

        event.deferReply(true).queue(hook -> {
            hook.editOriginalEmbeds(intro.build())
                    .setActionRow(
                            StringSelectMenu.create("select_game")
                                    .setPlaceholder("Choose your games")
                                    .setMinValues(1)
                                    .setMaxValues(5)
                                    .addOption("Storm Connections", "Storm Connections")
                                    .addOption("Storm Evolution", "Storm Evolution")
                                    .addOption("Storm 4", "Storm 4")
                                    .addOption("Storm Revolution", "Storm Revolution")
                                    .addOption("Storm Trilogy", "Storm Trilogy")
                                    .build()
                    ).queue();
        });
    }

    @Override
    public void onStringSelectInteraction(StringSelectInteractionEvent event) {
        long discordId = event.getUser().getIdLong();
        PlayerInfo player = PlayerInfoStorage.getPlayerInfo(discordId);

        if (event.getComponentId().equals("ninjacard:menu")) {
            handleNinjaCardMenu(event);
            return;
        }

        if (player == null) {
            event.reply("‚ùå Player profile not found. Please use /add_info_card to create one.")
                    .setEphemeral(true).queue();
            return;
        }

        switch (event.getComponentId()) {
            case "select_game" -> {
                player.setGame(event.getValues().toArray(new String[0]));
                PlayerInfoStorage.addOrUpdatePlayerInfo(discordId, player);
                event.deferEdit().queue();
                askPlatforms(event);
            }
            case "select_platforms" -> {
                player.setPlatforms(event.getValues().toArray(new String[0]));
                PlayerInfoStorage.addOrUpdatePlayerInfo(discordId, player);
                event.deferEdit().queue();
                askConnectionType(event);
            }
            case "select_connection" -> {
                player.setConnectionType(event.getValues().get(0));
                PlayerInfoStorage.addOrUpdatePlayerInfo(discordId, player);
                event.deferEdit().queue();
                askCurrentRegion(event);
            }
            case "select_region" -> {
                player.setCurrentRegion(event.getValues().get(0));
                PlayerInfoStorage.addOrUpdatePlayerInfo(discordId, player);
                event.deferEdit().queue();
                askTargetRegion(event);
            }
            case "select_target_region" -> {
                player.setTargetRegion(event.getValues().get(0));
                PlayerInfoStorage.addOrUpdatePlayerInfo(discordId, player);
                event.deferEdit().queue();
                askLanguages(event);
            }
            case "select_languages" -> {
                player.setSpokenLanguages(event.getValues().toArray(new String[0]));
                PlayerInfoStorage.addOrUpdatePlayerInfo(discordId, player);
                askFinalModal(event);
            }
        }
    }

    private void handleNinjaCardMenu(StringSelectInteractionEvent event) {
        if (lastQueriedUserId == -1) {
            event.reply("‚ùå No user info found for this menu interaction. Please retry.")
                    .setEphemeral(true).queue();
            return;
        }

        PlayerInfo player = PlayerInfoStorage.getPlayerInfo(lastQueriedUserId);
        PlayerStats stats = PlayerStatsManager.getInstance().getPlayerStats(lastQueriedUserId);

        if (player == null || stats == null) {
            event.reply("‚ùå Player info or stats missing.").setEphemeral(true).queue();
            return;
        }

        String selected = event.getValues().get(0);
        EmbedBuilder embed;

        switch (selected) {
            case "ninjacard" -> embed = getNinjaCardEmbed(player);
            case "general" -> embed = getGeneralStatsEmbed(stats);
            case "direct" -> embed = getDirectStatsEmbed(stats);
            default -> {
                embed = new EmbedBuilder()
                        .setDescription("Invalid selection!")
                        .setColor(Color.RED);
            }
        }

        // Qui modifico il messaggio originario che √® effimero
        event.replyEmbeds(embed.build()).setEphemeral(true).queue();
    }


    private void askPlatforms(StringSelectInteractionEvent event) {
        EmbedBuilder embed = new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ üéÆ Platform ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setDescription(" > Select all platforms you play on (multiple selections allowed).\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.white);

        event.getHook().editOriginalEmbeds(embed.build())
                .setActionRow(
                        StringSelectMenu.create("select_platforms")
                                .setPlaceholder("Choose your platforms")
                                .setMaxValues(4)
                                .addOption("PlayStation (PSN)", "PSN")
                                .addOption("PC (Steam/Epic)", "PC")
                                .addOption("Xbox", "Xbox")
                                .addOption("Nintendo Switch", "Switch")
                                .build()
                ).queue();
    }

    private void askConnectionType(StringSelectInteractionEvent event) {
        EmbedBuilder embed = new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ Connection Type ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setDescription(" > Select the type of connection you use to play online.\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.white);

        event.getHook().editOriginalEmbeds(embed.build())
                .setActionRow(
                        StringSelectMenu.create("select_connection")
                                .addOption("WiFi", "WiFi")
                                .addOption("Wired", "Wired")
                                .build()
                ).queue();
    }

    private void askCurrentRegion(StringSelectInteractionEvent event) {
        EmbedBuilder embed = new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ üåç Your Region ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setDescription(" > Where are you currently located?\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.white);

        event.getHook().editOriginalEmbeds(embed.build())
                .setActionRow(
                        StringSelectMenu.create("select_region")
                                .addOption("EU", "EU")
                                .addOption("NA", "NA")
                                .addOption("SA", "SA")
                                .addOption("JP", "JP")
                                .build()
                ).queue();
    }

    private void askTargetRegion(StringSelectInteractionEvent event) {
        EmbedBuilder embed = new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ üéØ Target Region ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setDescription(" > Which region do you want to play with?\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.white);

        event.getHook().editOriginalEmbeds(embed.build())
                .setActionRow(
                        StringSelectMenu.create("select_target_region")
                                .addOption("EU", "EU")
                                .addOption("NA", "NA")
                                .addOption("JP", "JP")
                                .addOption("SA", "SA")
                                .build()
                ).queue();
    }

    private void askLanguages(StringSelectInteractionEvent event) {
        EmbedBuilder embed = new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ üó£Ô∏è Spoken Languages ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setDescription(" > Select the languages you speak (you can choose multiple).\n\n‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.white);

        event.getHook().editOriginalEmbeds(embed.build())
                .setActionRow(
                        StringSelectMenu.create("select_languages")
                                .setPlaceholder("Choose languages")
                                .setMaxValues(6)
                                .addOption("English", "English")
                                .addOption("French", "French")
                                .addOption("Spanish", "Spanish")
                                .addOption("Italian", "Italian")
                                .addOption("Arabic", "Arabian")
                                .addOption("Japanese", "Japanese")
                                .build()
                ).queue();
    }

    private void askFinalModal(StringSelectInteractionEvent event) {
        event.getHook().editOriginalComponents().queue();

        Modal modal = Modal.create("final_modal", "Final Profile Details")
                .addActionRow(TextInput.create("player_name", "In-Game Name", TextInputStyle.SHORT).setRequired(true).setPlaceholder("e.g. User1234").build())
                .addActionRow(TextInput.create("hours_played", "Hours Played (number)", TextInputStyle.SHORT).setRequired(true).setPlaceholder("e.g. 120").build())
                .addActionRow(TextInput.create("available_time", "When Do You Play?", TextInputStyle.PARAGRAPH).setRequired(true).setPlaceholder("e.g. Weekends, evenings...").build())
                .build();

        event.replyModal(modal).queue();
    }

    @Override
    public void onModalInteraction(ModalInteractionEvent event) {
        if (!event.getModalId().equals("final_modal")) return;

        long discordId = event.getUser().getIdLong();
        PlayerInfo player = PlayerInfoStorage.getPlayerInfo(discordId);

        if (player == null) {
            event.reply("‚ùå Player profile not found. Please use /add_info_card to create one.").setEphemeral(true).queue();
            return;
        }

        player.setPlayerName(event.getValue("player_name").getAsString());

        try {
            player.setInGamePlayTime(String.valueOf(Integer.parseInt(event.getValue("hours_played").getAsString())));
        } catch (NumberFormatException e) {
            event.reply("‚ùå Please enter a valid number for hours played.").setEphemeral(true).queue();
            return;
        }

        player.setAvailablePlayTime(event.getValue("available_time").getAsString());
        PlayerInfoStorage.addOrUpdatePlayerInfo(discordId, player);
        PlayerInfoFileManager.savePlayerInfoList(PlayerInfoStorage.getAllSessions());

        event.reply("‚úÖ Your profile has been successfully updated!").setEphemeral(true).queue();
        player.sendPlayerInfoLog(Objects.requireNonNull(event.getGuild()));
    }

    @Override
    public void onGuildReady(GuildReadyEvent event) {
        PlayerInfoStorage.loadSessions(PlayerInfoMongoDBManager.getAllPlayerInfosAsMap());
    }

    public EmbedBuilder getNinjaCardEmbed(PlayerInfo p) {
        return new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ Your Ninja Card ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.decode("#1c0b2e"))
                .setDescription(
                        "**# Ninja Card Info:**\n" +
                                " * **Platform:** " + String.join(", ", p.getPlatforms()) + "\n" +
                                " * **Game:** " + String.join(", ", p.getGame()) + "\n" +
                                " * **Player Name:** " + p.getPlayerName() + "\n" +
                                " * **Connection:** " + p.getConnectionType() + "\n" +
                                " * **My Region:** " + p.getCurrentRegion() + "\n" +
                                " * **Target Region:** " + p.getTargetRegion() + "\n" +
                                " * **Languages:** " + String.join(", ", p.getSpokenLanguages()) + "\n" +
                                " * **Availability:** " + p.getAvailablePlayTime() + "\n" +
                                " * **Hours Played:** " + p.getInGamePlayTime() + "\n" +
                                " * **Lobbies Joined:** " + p.getLobbyCounter() + "\n"
                );
    }

    public EmbedBuilder getGeneralStatsEmbed(PlayerStats stats) {
        return new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ Your General Stats ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.decode("#1c0b2e"))
                .setDescription(
                        "**# General Stats:**\n" +
                                " * **Lobbies Created:** " + stats.getLobbiesCreatedGeneral() + "\n" +
                                " * **Lobbies Joined:** " + stats.getLobbiesJoinedGeneral() + "\n" +
                                " * **Host Accepted Users:** " + stats.getHostAcceptedUserGeneral() + "\n" +
                                " * **Was Accepted:** " + stats.getWasAcceptedGeneral() + "\n" +
                                " * **Declined Users:** " + stats.getDeclinedUserGeneral() + "\n" +
                                " * **Was Declined:** " + stats.getWasDeclinedGeneral() + "\n" +
                                " * **Ignored Requests:** " + stats.getIgnoredRequestGeneral() + "\n" +
                                " * **Lobbies Completed:** " + stats.getLobbiesCompletedGeneral() + "\n" +
                                " * **Lobbies Incomplete:** " + stats.getLobbiesIncompleteGeneral() + "\n" +
                                " * **Lobbies Disbanded:** " + stats.getLobbiesDisbandedGeneral() + "\n"
                );
    }

    public EmbedBuilder getDirectStatsEmbed(PlayerStats stats) {
        return new EmbedBuilder()
                .setTitle("‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨ Your Direct Stats ‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨")
                .setColor(Color.decode("#1c0b2e"))
                .setDescription(
                        "**# Direct Stats:**\n" +
                                " * **Lobbies Created:** " + stats.getLobbiesCreatedDirect() + "\n" +
                                " * **Lobbies Joined:** " + stats.getLobbiesJoinedDirect() + "\n" +
                                " * **Was Accepted:** " + stats.getWasAcceptedDirect() + "\n" +
                                " * **Declined Users:** " + stats.getDeclinedUserDirect() + "\n" +
                                " * **Was Declined:** " + stats.getWasDeclinedDirect() + "\n" +
                                " * **Ignored Requests:** " + stats.getIgnoredRequestDirect() + "\n" +
                                " * **Lobbies Completed:** " + stats.getLobbiesCompletedDirect() + "\n" +
                                " * **Lobbies Incomplete:** " + stats.getLobbiesIncompleteDirect() + "\n" +
                                " * **Lobbies Disbanded:** " + stats.getLobbiesDisbandedDirect() + "\n"
                );
    }
}
